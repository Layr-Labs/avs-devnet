# AvsDevnet CLI

A wrapper over the [Kurtosis CLI](https://docs.kurtosis.com/cli).
Provides an easier way to interact with the devnet package.

## How to Install

<!-- TODO: add instructions on how to install -->

Clone the repo, and inside this directory, run:

```sh
make deps     # installs dependencies
make install  # installs the project

# this command should be run once per shell
source env.sh # set env-vars
```

## How to Use

### Creating a devnet config

This will create a new devnet config.
By default it's stored as `devnet.yaml`, but another name can be passed as parameter.

```sh
devnet init
```

The default configuration deploys EigenLayer with a single strategy and operator.
It also starts up a [blockscout explorer](https://github.com/blockscout/blockscout).

### Starting the devnet

This will start a devnet according to the configuration inside `devnet.yaml`.
Another file name can be specified as the first parameter.

```sh
devnet start
```

Note that only one devnet per file name can be running at the same time.
Trying to start another one (or the same one more than once) will fail.

### Stopping the devnet

This will stop the devnet according to the configuration inside `devnet.yaml`.
Another file name can be specified as the first parameter.

```sh
devnet stop
```

### Fetching the address of a contract

This will output the address of the deployed contract named `delegation`, from the artifact `eigenlayer_addresses`.
In the default configuration, this corresponds to the address of EigenLayer's `DelegationManager`.

```sh
$ devnet get-address eigenlayer_addresses:delegation
0x9f9F5Fd89ad648f2C000C954d8d9C87743243eC5
```

This works by parsing the JSON artifacts generated by the deployment scripts.
The command expects there to be a single file with a field called "addresses" under which addresses are listed.

More examples:

```sh
# print all addresses in eigenlayer_addresses artifact
$ devnet get-address eigenlayer_addresses:
{
  "addresses": {
    # ...
    "delegation": "0x9f9F5Fd89ad648f2C000C954d8d9C87743243eC5",
    # ...
    "strategies": {
      "MockETH": "0x2b45cD38B213Bbd3A1A848bf2467927c976877Cb"
    },
    # ...
  },
  # ...
}
# print the address under strategies -> MockETH
$ devnet get-address eigenlayer_addresses:strategies.MockETH
0x2b45cD38B213Bbd3A1A848bf2467927c976877Cb
# because we also search nested entries, the last one can be shortened to
$ devnet get-address eigenlayer_addresses:MockETH
0x2b45cD38B213Bbd3A1A848bf2467927c976877Cb
# by adding a . at the start, we disable the search function
$ devnet get-address eigenlayer_addresses:.MockETH  # this fails
Contract not found: eigenlayer_addresses:.MockETH
```

### More Help

You can find the options for each command by appending `--help`:

```sh
$ devnet --help
NAME:
   devnet - start an AVS devnet

USAGE:
   devnet [global options] command [command options]

VERSION:
   development

COMMANDS:
   init         Initialize a devnet configuration file
   start        Start devnet from configuration file
   stop         Stop devnet from configuration file
   get-address  Get a devnet contract or EOA address
   help, h      Shows a list of commands or help for one command

GLOBAL OPTIONS:
   --help, -h     show help
   --version, -v  print the version
```
